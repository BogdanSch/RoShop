(()=>{"use strict";class e{constructor(e,s,t){e&&(this._$=t,this._$el=t(e),this._params=s||{},this._initSelect2(),this._initEvents())}setValue(e){this._$el&&this._$el.val(e).trigger("change.select2")}getValue(){return this._$el.val()}setOptions(e){let s="";this._params.placeholder&&e.unshift({value:"",name:this._params.placeholder}),e.forEach((e=>{s+=`<option value="${e.value}">${e.name}</option>`})),this.setOptionsHtml(s),this._hasMirror()&&this._getMirror().setOptionsHtml(s),this._params.ajax&&this._params.ajax.target().setOptions([])}setOptionsHtml(e){this._$el&&this._$el.html(e)}_initSelect2(){let e=this;"function"==typeof this._$.fn.select2&&this._$el.select2({sorter:function(s){return s.sort((function(t,i){let n=e._$(".select2-search__field");if(0===n.length||""===n.val())return s;let a=t.text.toLowerCase(),l=i.text.toLowerCase(),c=n.val().toLowerCase();return a.indexOf(c)<l.indexOf(c)?-1:a.indexOf(c)>l.indexOf(c)?1:0})),s},language:{noResults:function(){return wc_ukr_shipping_globals.i10n.not_found}}})}_initEvents(){let e=this;e._$el.on("change",(function(){e._hasMirror()&&e._getMirror().setValue(e.getValue()),e._params.ajax&&e._getAjaxData()}))}_getAjaxData(){let e=this;e._trigger("beforeRequest");let s={action:e._params.ajax.action,_token:wc_ukr_shipping_globals.nonce,value:e.getValue()};"function"==typeof e._params.ajax.params&&(s=Object.assign(s,e._params.ajax.params())),e._$.ajax({method:"POST",url:wc_ukr_shipping_globals.ajaxUrl,data:s,dataType:"json",success:function(s){e._trigger("response",{data:s.data}),s.success&&e._params.ajax.target().setOptions(s.data.items)},error:function(s,t,i){e._trigger("response"),console.error(`WCUS Error: ${s.status} ${s.statusText}`)}})}_hasMirror(){return"function"==typeof this._params.mirror}_getMirror(){return this._params.mirror()}_trigger(e,s){this._params.events&&"function"==typeof this._params.events[e]&&this._params.events[e](this,s||{})}}const s={init:function(e){this._$=e,this.$differentShipping=this._$("#ship-to-different-address-checkbox")},setLoadingState:function(){this._$(".wc-ukr-shipping-np-fields").addClass("wcus-state-loading")},unsetLoadingState:function(){this._$(".wc-ukr-shipping-np-fields").removeClass("wcus-state-loading")},getFieldType:function(){return this.$differentShipping.length&&this.$differentShipping.prop("checked")?"shipping":"billing"},isCustomAddress:function(){let e=this.getFieldType();return this._$("#wcus_np_"+e+"_custom_address_active").prop("checked")?1:0},getAreaRef:function(){let e=this.getFieldType();return this._$("#wcus_np_"+e+"_area").val()},getCityRef:function(){let e=this.getFieldType();return this._$("#wcus_np_"+e+"_city").val()},mergeSelectParams:function(e){let s=this;return Object.assign({events:{beforeRequest:function(e){s.setLoadingState()},response:function(e){s.unsetLoadingState()}},i10n:{noResult:wc_ukr_shipping_globals.i10n.not_found}},e)}};!function(t){let i,n=document.getElementById("ship-to-different-address-checkbox");function a(){s.getCityRef()&&(t("#place_order").prop("disabled",!0),t.ajax({method:"POST",url:wc_ukr_shipping_globals.ajaxUrl,data:{action:"wcus_calculate_cost",_token:wc_ukr_shipping_globals.nonce,wcus_ajax:1,wcus_area_ref:s.getAreaRef(),wcus_city_ref:s.getCityRef(),wcus_address_shipping:s.isCustomAddress(),wcus_payment_method:t('input[name="payment_method"]:checked').val(),wcus_method_name:t("#wcus-shipping-name").val()},dataType:"json",success:function(e){t("#place_order").prop("disabled",!1),e.success&&(t("#wcus-shipping-cost").html(e.data.shipping),t("#wcus-order-total").html(`<strong>${e.data.total}</strong>`))},error:function(e,s,i){t("#place_order").prop("disabled",!1),console.error(`WCUS Error: ${e.status} ${e.statusText}`)}}))}s.init(t);let l=function(){let e=t(".shipping_method").length>1?t(".shipping_method:checked").val():t(".shipping_method").val();return e&&e.match(/^nova_poshta_shipping.+/i)};n&&n.addEventListener("click",(function(){l()&&(this.checked?(t("#wcus_np_shipping_fields").css("display","block"),t("#wcus_np_billing_fields").css("display","none")):(t("#wcus_np_shipping_fields").css("display","none"),t("#wcus_np_billing_fields").css("display","block")))}));t((function(){let c,o,r,_,p,d;t(".wc-ukr-shipping-np-fields").css("display","none"),t(document.body).bind("update_checkout",(function(e,t){s.setLoadingState()})),t(document.body).bind("updated_checkout",(function(e,a){i=t("#billing_country").length?t("#billing_country").val():"UA","UA"===i&&l()?n&&n.checked?t("#wcus_np_shipping_fields").css("display","block"):t("#wcus_np_billing_fields").css("display","block"):t(".wc-ukr-shipping-np-fields").css("display","none"),l()&&1===parseInt(wc_ukr_shipping_globals.disableDefaultBillingFields)?(t("#billing_address_1_field").css("display","none"),t("#billing_address_2_field").css("display","none"),t("#billing_city_field").css("display","none"),t("#billing_state_field").css("display","none"),t("#billing_postcode_field").css("display","none"),t("#shipping_address_1_field").css("display","none"),t("#shipping_address_2_field").css("display","none"),t("#shipping_city_field").css("display","none"),t("#shipping_state_field").css("display","none"),t("#shipping_postcode_field").css("display","none")):(t("#billing_address_1_field").css("display","block"),t("#billing_address_2_field").css("display","block"),t("#billing_city_field").css("display","block"),t("#billing_state_field").css("display","block"),t("#billing_postcode_field").css("display","block"),t("#shipping_address_1_field").css("display","block"),t("#shipping_address_2_field").css("display","block"),t("#shipping_city_field").css("display","block"),t("#shipping_state_field").css("display","block"),t("#shipping_postcode_field").css("display","block")),s.unsetLoadingState()})),c=new e(document.getElementById("wcus_np_billing_area"),s.mergeSelectParams({mirror:()=>o,ajax:{action:"wcus_api_v2_get_cities",target:()=>r},placeholder:wc_ukr_shipping_globals.i10n.placeholder_area}),t),o=new e(document.getElementById("wcus_np_shipping_area"),s.mergeSelectParams({mirror:()=>c,ajax:{action:"wcus_api_v2_get_cities",target:()=>_},placeholder:wc_ukr_shipping_globals.i10n.placeholder_area}),t),r=new e(document.getElementById("wcus_np_billing_city"),s.mergeSelectParams({mirror:()=>_,ajax:{action:"wcus_api_v2_get_warehouses",target:()=>p},events:{beforeRequest:function(e){s.setLoadingState(),a()},response:function(e,t){s.unsetLoadingState()}},placeholder:wc_ukr_shipping_globals.i10n.placeholder_city}),t),_=new e(document.getElementById("wcus_np_shipping_city"),s.mergeSelectParams({mirror:()=>r,ajax:{action:"wcus_api_v2_get_warehouses",target:()=>d},events:{beforeRequest:function(e){s.setLoadingState(),a()},response:function(e,t){s.unsetLoadingState()}},placeholder:wc_ukr_shipping_globals.i10n.placeholder_city}),t),p=new e(document.getElementById("wcus_np_billing_warehouse"),s.mergeSelectParams({mirror:()=>d,placeholder:wc_ukr_shipping_globals.i10n.placeholder_warehouse}),t),d=new e(document.getElementById("wcus_np_shipping_warehouse"),s.mergeSelectParams({mirror:()=>p,placeholder:wc_ukr_shipping_globals.i10n.placeholder_warehouse}),t),t("body").on("change",'input[name="payment_method"]',(function(){a()})),function(){let e=t(".j-wcus-np-custom-address");e.length&&e.on("click",(function(){let e=document.getElementById(this.dataset.relationSelect);e&&(e.checked=this.checked),this.checked?(t(".j-wcus-warehouse-block").slideUp(400),t(".j-wcus-np-custom-address-block").slideDown(400)):(t(".j-wcus-warehouse-block").slideDown(400),t(".j-wcus-np-custom-address-block").slideUp(400)),a()}))}()}))}(jQuery)})();